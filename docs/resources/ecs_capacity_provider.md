
---
page_title: "awscc_ecs_capacity_provider Resource - terraform-provider-awscc"
subcategory: ""
description: |-
  Resource Type definition for AWS::ECS::CapacityProvider.
---

# awscc_ecs_capacity_provider (Resource)

Resource Type definition for AWS::ECS::CapacityProvider.

## Example Usage

### ECS Capacity Provider with Auto Scaling

Creates an ECS Capacity Provider with managed scaling enabled, configured to use an Auto Scaling Group with t3.micro instances and scale between 0 and 2 instances based on cluster needs.

~> This example is generated by LLM using Amazon Bedrock and validated using terraform validate, apply and destroy. While we strive for accuracy and quality, please note that the information provided may not be entirely error-free or up-to-date. We recommend independently verifying the content.

```terraform
# Find the most recent ECS-optimized AMI
data "aws_ami" "ecs_ami" {
  most_recent = true
  owners      = ["amazon"]

  filter {
    name   = "name"
    values = ["amzn2-ami-ecs-*"]
  }

  filter {
    name   = "virtualization-type"
    values = ["hvm"]
  }
}

# Get default VPC and subnet for simplicity
data "aws_vpc" "default" {
  default = true
}

data "aws_subnets" "default" {
  filter {
    name   = "vpc-id"
    values = [data.aws_vpc.default.id]
  }
}

# Security Group for ASG instances
resource "aws_security_group" "ecs_instances" {
  name_prefix = "ecs-instances-"
  description = "Security group for ECS instances"
  vpc_id      = data.aws_vpc.default.id

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }

  tags = {
    Name = "ecs-capacity-provider-sg"
  }
}

# Create IAM role for ECS instances
data "aws_iam_policy_document" "ecs_instance_assume_role" {
  statement {
    actions = ["sts:AssumeRole"]
    principals {
      type        = "Service"
      identifiers = ["ec2.amazonaws.com"]
    }
  }
}

resource "awscc_iam_role" "ecs_instance_role" {
  assume_role_policy_document = jsonencode(jsondecode(data.aws_iam_policy_document.ecs_instance_assume_role.json))
  managed_policy_arns         = ["arn:aws:iam::aws:policy/service-role/AmazonEC2ContainerServiceforEC2Role"]
  tags = [{
    key   = "Name"
    value = "ecs-instance-role"
  }]
}

# Create instance profile for ECS instances
resource "aws_iam_instance_profile" "ecs_instance_profile" {
  name = "ecs-instance-profile"
  role = awscc_iam_role.ecs_instance_role.role_name
}

# Create Launch Template
resource "aws_launch_template" "ecs" {
  name_prefix   = "ecs-template"
  image_id      = data.aws_ami.ecs_ami.id
  instance_type = "t3.micro"

  user_data = base64encode(<<-EOF
              #!/bin/bash
              echo ECS_CLUSTER=${awscc_ecs_cluster.example.cluster_name} >> /etc/ecs/ecs.config
              EOF
  )

  iam_instance_profile {
    name = aws_iam_instance_profile.ecs_instance_profile.name
  }

  vpc_security_group_ids = [aws_security_group.ecs_instances.id]

  tag_specifications {
    resource_type = "instance"
    tags = {
      Name = "ecs-instance"
    }
  }
}

# Create Auto Scaling Group
resource "aws_autoscaling_group" "ecs" {
  name                = "ecs-asg"
  desired_capacity    = 1
  max_size            = 2
  min_size            = 0
  target_group_arns   = []
  vpc_zone_identifier = [data.aws_subnets.default.ids[0]]

  launch_template {
    id      = aws_launch_template.ecs.id
    version = "$Latest"
  }

  tag {
    key                 = "Name"
    value               = "ecs-asg"
    propagate_at_launch = true
  }

  lifecycle {
    ignore_changes = [desired_capacity]
  }
}

# Create ECS Cluster
resource "awscc_ecs_cluster" "example" {
  cluster_name = "example"
  tags = [{
    key   = "Name"
    value = "example-cluster"
  }]
}

# Create ECS Capacity Provider
resource "awscc_ecs_capacity_provider" "example" {
  name = "example-capacity-provider"

  auto_scaling_group_provider = {
    auto_scaling_group_arn         = aws_autoscaling_group.ecs.arn
    managed_termination_protection = "DISABLED"
    managed_scaling = {
      status                    = "ENABLED"
      target_capacity           = 100
      minimum_scaling_step_size = 1
      maximum_scaling_step_size = 100
      instance_warmup_period    = 300
    }
  }

  tags = [{
    key   = "Modified By"
    value = "AWSCC"
  }]
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Optional

- `auto_scaling_group_provider` (Attributes) (see [below for nested schema](#nestedatt--auto_scaling_group_provider))
- `cluster_name` (String)
- `managed_instances_provider` (Attributes) (see [below for nested schema](#nestedatt--managed_instances_provider))
- `name` (String)
- `tags` (Attributes List) (see [below for nested schema](#nestedatt--tags))

### Read-Only

- `id` (String) Uniquely identifies the resource.

<a id="nestedatt--auto_scaling_group_provider"></a>
### Nested Schema for `auto_scaling_group_provider`

Optional:

- `auto_scaling_group_arn` (String)
- `managed_draining` (String)
- `managed_scaling` (Attributes) The managed scaling settings for the Auto Scaling group capacity provider. (see [below for nested schema](#nestedatt--auto_scaling_group_provider--managed_scaling))
- `managed_termination_protection` (String)

<a id="nestedatt--auto_scaling_group_provider--managed_scaling"></a>
### Nested Schema for `auto_scaling_group_provider.managed_scaling`

Optional:

- `instance_warmup_period` (Number)
- `maximum_scaling_step_size` (Number)
- `minimum_scaling_step_size` (Number)
- `status` (String)
- `target_capacity` (Number)



<a id="nestedatt--managed_instances_provider"></a>
### Nested Schema for `managed_instances_provider`

Optional:

- `infrastructure_optimization` (Attributes) Defines how Amazon ECS Managed Instances optimizes the infrastructure in your capacity provider. Configure it to turn on or off the infrastructure optimization in your capacity provider, and to control the idle EC2 instances optimization delay. (see [below for nested schema](#nestedatt--managed_instances_provider--infrastructure_optimization))
- `infrastructure_role_arn` (String)
- `instance_launch_template` (Attributes) (see [below for nested schema](#nestedatt--managed_instances_provider--instance_launch_template))
- `propagate_tags` (String)

<a id="nestedatt--managed_instances_provider--infrastructure_optimization"></a>
### Nested Schema for `managed_instances_provider.infrastructure_optimization`

Optional:

- `scale_in_after` (Number) This parameter defines the number of seconds Amazon ECS Managed Instances waits before optimizing EC2 instances that have become idle or underutilized. A longer delay increases the likelihood of placing new tasks on idle instances, reducing startup time. A shorter delay helps reduce infrastructure costs by optimizing idle instances more quickly. Valid values are: Not set (null) - Uses the default optimization behavior, `-1` - Disables automatic infrastructure optimization, `0` to `3600` (inclusive) - Specifies the number of seconds to wait before optimizing instances.


<a id="nestedatt--managed_instances_provider--instance_launch_template"></a>
### Nested Schema for `managed_instances_provider.instance_launch_template`

Optional:

- `capacity_option_type` (String)
- `ec_2_instance_profile_arn` (String)
- `fips_enabled` (Boolean)
- `instance_requirements` (Attributes) (see [below for nested schema](#nestedatt--managed_instances_provider--instance_launch_template--instance_requirements))
- `monitoring` (String)
- `network_configuration` (Attributes) (see [below for nested schema](#nestedatt--managed_instances_provider--instance_launch_template--network_configuration))
- `storage_configuration` (Attributes) (see [below for nested schema](#nestedatt--managed_instances_provider--instance_launch_template--storage_configuration))

<a id="nestedatt--managed_instances_provider--instance_launch_template--instance_requirements"></a>
### Nested Schema for `managed_instances_provider.instance_launch_template.instance_requirements`

Optional:

- `accelerator_count` (Attributes) (see [below for nested schema](#nestedatt--managed_instances_provider--instance_launch_template--instance_requirements--accelerator_count))
- `accelerator_manufacturers` (List of String)
- `accelerator_names` (List of String)
- `accelerator_total_memory_mi_b` (Attributes) (see [below for nested schema](#nestedatt--managed_instances_provider--instance_launch_template--instance_requirements--accelerator_total_memory_mi_b))
- `accelerator_types` (List of String)
- `allowed_instance_types` (List of String)
- `bare_metal` (String)
- `baseline_ebs_bandwidth_mbps` (Attributes) (see [below for nested schema](#nestedatt--managed_instances_provider--instance_launch_template--instance_requirements--baseline_ebs_bandwidth_mbps))
- `burstable_performance` (String)
- `cpu_manufacturers` (List of String)
- `excluded_instance_types` (List of String)
- `instance_generations` (List of String)
- `local_storage` (String)
- `local_storage_types` (List of String)
- `max_spot_price_as_percentage_of_optimal_on_demand_price` (Number)
- `memory_gi_b_per_v_cpu` (Attributes) (see [below for nested schema](#nestedatt--managed_instances_provider--instance_launch_template--instance_requirements--memory_gi_b_per_v_cpu))
- `memory_mi_b` (Attributes) (see [below for nested schema](#nestedatt--managed_instances_provider--instance_launch_template--instance_requirements--memory_mi_b))
- `network_bandwidth_gbps` (Attributes) (see [below for nested schema](#nestedatt--managed_instances_provider--instance_launch_template--instance_requirements--network_bandwidth_gbps))
- `network_interface_count` (Attributes) (see [below for nested schema](#nestedatt--managed_instances_provider--instance_launch_template--instance_requirements--network_interface_count))
- `on_demand_max_price_percentage_over_lowest_price` (Number)
- `require_hibernate_support` (Boolean)
- `spot_max_price_percentage_over_lowest_price` (Number)
- `total_local_storage_gb` (Attributes) (see [below for nested schema](#nestedatt--managed_instances_provider--instance_launch_template--instance_requirements--total_local_storage_gb))
- `v_cpu_count` (Attributes) (see [below for nested schema](#nestedatt--managed_instances_provider--instance_launch_template--instance_requirements--v_cpu_count))

<a id="nestedatt--managed_instances_provider--instance_launch_template--instance_requirements--accelerator_count"></a>
### Nested Schema for `managed_instances_provider.instance_launch_template.instance_requirements.accelerator_count`

Optional:

- `max` (Number)
- `min` (Number)


<a id="nestedatt--managed_instances_provider--instance_launch_template--instance_requirements--accelerator_total_memory_mi_b"></a>
### Nested Schema for `managed_instances_provider.instance_launch_template.instance_requirements.accelerator_total_memory_mi_b`

Optional:

- `max` (Number)
- `min` (Number)


<a id="nestedatt--managed_instances_provider--instance_launch_template--instance_requirements--baseline_ebs_bandwidth_mbps"></a>
### Nested Schema for `managed_instances_provider.instance_launch_template.instance_requirements.baseline_ebs_bandwidth_mbps`

Optional:

- `max` (Number)
- `min` (Number)


<a id="nestedatt--managed_instances_provider--instance_launch_template--instance_requirements--memory_gi_b_per_v_cpu"></a>
### Nested Schema for `managed_instances_provider.instance_launch_template.instance_requirements.memory_gi_b_per_v_cpu`

Optional:

- `max` (Number)
- `min` (Number)


<a id="nestedatt--managed_instances_provider--instance_launch_template--instance_requirements--memory_mi_b"></a>
### Nested Schema for `managed_instances_provider.instance_launch_template.instance_requirements.memory_mi_b`

Optional:

- `max` (Number)
- `min` (Number)


<a id="nestedatt--managed_instances_provider--instance_launch_template--instance_requirements--network_bandwidth_gbps"></a>
### Nested Schema for `managed_instances_provider.instance_launch_template.instance_requirements.network_bandwidth_gbps`

Optional:

- `max` (Number)
- `min` (Number)


<a id="nestedatt--managed_instances_provider--instance_launch_template--instance_requirements--network_interface_count"></a>
### Nested Schema for `managed_instances_provider.instance_launch_template.instance_requirements.network_interface_count`

Optional:

- `max` (Number)
- `min` (Number)


<a id="nestedatt--managed_instances_provider--instance_launch_template--instance_requirements--total_local_storage_gb"></a>
### Nested Schema for `managed_instances_provider.instance_launch_template.instance_requirements.total_local_storage_gb`

Optional:

- `max` (Number)
- `min` (Number)


<a id="nestedatt--managed_instances_provider--instance_launch_template--instance_requirements--v_cpu_count"></a>
### Nested Schema for `managed_instances_provider.instance_launch_template.instance_requirements.v_cpu_count`

Optional:

- `max` (Number)
- `min` (Number)



<a id="nestedatt--managed_instances_provider--instance_launch_template--network_configuration"></a>
### Nested Schema for `managed_instances_provider.instance_launch_template.network_configuration`

Optional:

- `security_groups` (List of String)
- `subnets` (List of String)


<a id="nestedatt--managed_instances_provider--instance_launch_template--storage_configuration"></a>
### Nested Schema for `managed_instances_provider.instance_launch_template.storage_configuration`

Optional:

- `storage_size_gi_b` (Number)




<a id="nestedatt--tags"></a>
### Nested Schema for `tags`

Optional:

- `key` (String)
- `value` (String)

## Import

Import is supported using the following syntax:

In Terraform v1.12.0 and later, the [`import` block](https://developer.hashicorp.com/terraform/language/import) can be used with the `identity` attribute, for example:

```terraform
import {
  to = awscc_ecs_capacity_provider.example
  identity = {
    name = "name"
  }
}
```

<!-- schema generated by tfplugindocs -->
### Identity Schema

#### Required

- `name` (String)

#### Optional

- `account_id` (String) AWS Account where this resource is managed
- `region` (String) Region where this resource is managed

In Terraform v1.5.0 and later, the [`import` block](https://developer.hashicorp.com/terraform/language/import) can be used with the `id` attribute, for example:

```terraform
import {
  to = awscc_ecs_capacity_provider.example
  id = "name"
}
```

The [`terraform import` command](https://developer.hashicorp.com/terraform/cli/commands/import) can be used, for example:

```shell
$ terraform import awscc_ecs_capacity_provider.example "name"
```
