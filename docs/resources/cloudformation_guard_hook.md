---
page_title: "awscc_cloudformation_guard_hook Resource - terraform-provider-awscc"
subcategory: ""
description: |-
  This is a CloudFormation resource for activating the first-party AWS::Hooks::GuardHook.
---

# awscc_cloudformation_guard_hook (Resource)

This is a CloudFormation resource for activating the first-party AWS::Hooks::GuardHook.

## Example Usage

```terraform
# Data sources for dynamic values
data "aws_caller_identity" "current" {}
data "aws_region" "current" {}

# S3 bucket for Guard rules and validation reports
resource "awscc_s3_bucket" "guard_bucket" {
  bucket_name = "cloudformation-guard-rules-${random_id.bucket_suffix.hex}"

  tags = [{
    key   = "Modified By"
    value = "AWSCC"
  }]
}

resource "random_id" "bucket_suffix" {
  byte_length = 4
}

resource "awscc_iam_role" "guard_hook_role" {
  role_name = "CloudFormationGuardHookRole"

  assume_role_policy_document = jsonencode({
    Version = "2012-10-17"
    Statement = [
      {
        Effect = "Allow"
        Principal = {
          Service = "hooks.cloudformation.amazonaws.com"
        }
        Action = "sts:AssumeRole"
      }
    ]
  })

  policies = [{
    policy_name = "GuardHookExecutionPolicy"
    policy_document = jsonencode({
      Version = "2012-10-17"
      Statement = [
        {
          Effect = "Allow"
          Action = [
            "s3:GetObject",
            "s3:GetObjectVersion"
          ]
          Resource = "${awscc_s3_bucket.guard_bucket.arn}/*"
        },
        {
          Effect = "Allow"
          Action = [
            "s3:PutObject",
            "s3:PutObjectAcl"
          ]
          Resource = "${awscc_s3_bucket.guard_bucket.arn}/reports/*"
        },
        {
          Effect = "Allow"
          Action = [
            "logs:CreateLogGroup",
            "logs:CreateLogStream",
            "logs:PutLogEvents"
          ]
          Resource = "arn:aws:logs:${data.aws_region.current.name}:${data.aws_caller_identity.current.account_id}:*"
        }
      ]
    })
  }]

  tags = [{
    key   = "Modified By"
    value = "AWSCC"
  }]
}

# Upload sample Guard rule file
resource "aws_s3_object" "sample_guard_rule" {
  bucket = awscc_s3_bucket.guard_bucket.bucket_name
  key    = "rules/security-rules.guard"

  content = <<-EOT
    # Sample Guard rules for security validation
    
    # Ensure Lambda functions use supported runtimes
    AWS::Lambda::Function {
        Properties.Runtime in [
            "python3.9", "python3.10", "python3.11", "python3.12",
            "nodejs18.x", "nodejs20.x",
            "java11", "java17", "java21",
            "dotnet6", "dotnet8"
        ]
    }
  EOT

  content_type = "text/plain"

  tags = {
    "Modified By" = "AWSCC"
  }
}

# CloudFormation Guard Hook
resource "awscc_cloudformation_guard_hook" "security_validation_hook" {
  alias          = "CCAPI::Lambda::Hooks"
  execution_role = awscc_iam_role.guard_hook_role.arn

  rule_location = {
    uri = "s3://${awscc_s3_bucket.guard_bucket.bucket_name}/rules/"
  }

  target_operations = ["CLOUD_CONTROL"]

  failure_mode = "FAIL"
  hook_status  = "ENABLED"
  log_bucket   = awscc_s3_bucket.guard_bucket.bucket_name

  # Target specific resource types for validation
  target_filters = {
    actions           = ["CREATE", "UPDATE"]
    invocation_points = ["PRE_PROVISION"]
    target_names      = ["AWS::Lambda::Function"]
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `alias` (String) The typename alias for the hook.
- `execution_role` (String) The execution role ARN assumed by hooks to read Guard rules from S3 and write Guard outputs to S3.
- `rule_location` (Attributes) S3 Source Location for the Guard files. (see [below for nested schema](#nestedatt--rule_location))
- `target_operations` (List of String) Which operations should this Hook run against? Resource changes, stacks or change sets.

### Optional

- `failure_mode` (String) Attribute to specify CloudFormation behavior on hook failure.
- `hook_status` (String) Attribute to specify which stacks this hook applies to or should get invoked for
- `log_bucket` (String) S3 Bucket where the guard validate report will be uploaded to
- `options` (Attributes) (see [below for nested schema](#nestedatt--options))
- `stack_filters` (Attributes) Filters to allow hooks to target specific stack attributes (see [below for nested schema](#nestedatt--stack_filters))
- `target_filters` (Attributes) Attribute to specify which targets should invoke the hook (see [below for nested schema](#nestedatt--target_filters))

### Read-Only

- `hook_arn` (String) The Amazon Resource Name (ARN) of the activated hook
- `id` (String) Uniquely identifies the resource.

<a id="nestedatt--rule_location"></a>
### Nested Schema for `rule_location`

Required:

- `uri` (String) S3 uri of Guard files.

Optional:

- `version_id` (String) S3 object version


<a id="nestedatt--options"></a>
### Nested Schema for `options`

Optional:

- `input_params` (Attributes) S3 Source Location for the Guard files. (see [below for nested schema](#nestedatt--options--input_params))

<a id="nestedatt--options--input_params"></a>
### Nested Schema for `options.input_params`

Optional:

- `uri` (String) S3 uri of Guard files.
- `version_id` (String) S3 object version



<a id="nestedatt--stack_filters"></a>
### Nested Schema for `stack_filters`

Optional:

- `filtering_criteria` (String) Attribute to specify the filtering behavior. ANY will make the Hook pass if one filter matches. ALL will make the Hook pass if all filters match
- `stack_names` (Attributes) List of stack names as filters (see [below for nested schema](#nestedatt--stack_filters--stack_names))
- `stack_roles` (Attributes) List of stack roles that are performing the stack operations. (see [below for nested schema](#nestedatt--stack_filters--stack_roles))

<a id="nestedatt--stack_filters--stack_names"></a>
### Nested Schema for `stack_filters.stack_names`

Optional:

- `exclude` (Set of String) List of stack names that the hook is going to be excluded from
- `include` (Set of String) List of stack names that the hook is going to target


<a id="nestedatt--stack_filters--stack_roles"></a>
### Nested Schema for `stack_filters.stack_roles`

Optional:

- `exclude` (Set of String) List of stack roles that the hook is going to be excluded from
- `include` (Set of String) List of stack roles that the hook is going to target



<a id="nestedatt--target_filters"></a>
### Nested Schema for `target_filters`

Optional:

- `actions` (Set of String) List of actions that the hook is going to target
- `invocation_points` (Set of String) List of invocation points that the hook is going to target
- `target_names` (Set of String) List of type names that the hook is going to target
- `targets` (Attributes List) List of hook targets (see [below for nested schema](#nestedatt--target_filters--targets))

<a id="nestedatt--target_filters--targets"></a>
### Nested Schema for `target_filters.targets`

Optional:

- `action` (String) Target actions are the type of operation hooks will be executed at.
- `invocation_point` (String) Invocation points are the point in provisioning workflow where hooks will be executed.
- `target_name` (String) Type name of hook target. Hook targets are the destination where hooks will be invoked against.

## Import

Import is supported using the following syntax:

```shell
$ terraform import awscc_cloudformation_guard_hook.example "hook_arn"
```
