
---
page_title: "awscc_secretsmanager_rotation_schedule Resource - terraform-provider-awscc"
subcategory: ""
description: |-
  Resource Type definition for AWS::SecretsManager::RotationSchedule
---

# awscc_secretsmanager_rotation_schedule (Resource)

Resource Type definition for AWS::SecretsManager::RotationSchedule

## Example Usage

### Secrets Manager Rotation Schedule with Lambda

Creates an AWS Secrets Manager rotation schedule that automatically rotates secrets every 30 days using a Lambda function, with immediate rotation on updates and a 3-hour rotation window.

~> This example is generated by LLM using Amazon Bedrock and validated using terraform validate, apply and destroy. While we strive for accuracy and quality, please note that the information provided may not be entirely error-free or up-to-date. We recommend independently verifying the content.

```terraform
# Get the current AWS region and account ID
data "aws_region" "current" {}

data "aws_caller_identity" "current" {}

# Create a Secrets Manager Secret
resource "awscc_secretsmanager_secret" "example" {
  name        = "example-rotation-secret"
  description = "Example secret for rotation schedule"
  tags = [{
    key   = "Modified By"
    value = "AWSCC"
  }]
}

# Create a Lambda function role
data "aws_iam_policy_document" "assume_role" {
  statement {
    actions = ["sts:AssumeRole"]
    principals {
      type        = "Service"
      identifiers = ["lambda.amazonaws.com"]
    }
  }
}

data "aws_iam_policy_document" "lambda_permissions" {
  statement {
    effect = "Allow"
    actions = [
      "secretsmanager:GetSecretValue",
      "secretsmanager:DescribeSecret",
      "secretsmanager:PutSecretValue",
      "secretsmanager:UpdateSecretVersionStage"
    ]
    resources = [awscc_secretsmanager_secret.example.id]
  }

  statement {
    effect = "Allow"
    actions = [
      "logs:CreateLogGroup",
      "logs:CreateLogStream",
      "logs:PutLogEvents"
    ]
    resources = ["arn:aws:logs:${data.aws_region.current.name}:${data.aws_caller_identity.current.account_id}:log-group:/aws/lambda/*"]
  }
}

resource "awscc_iam_role" "lambda_role" {
  role_name                   = "example-rotation-lambda-role"
  assume_role_policy_document = jsonencode(jsondecode(data.aws_iam_policy_document.assume_role.json))
  policies = [{
    policy_document = jsonencode(jsondecode(data.aws_iam_policy_document.lambda_permissions.json))
    policy_name     = "example-rotation-lambda-policy"
  }]
  tags = [{
    key   = "Modified By"
    value = "AWSCC"
  }]
}

# Create a Lambda function for rotation
resource "aws_lambda_function" "rotation" {
  filename      = "rotation.zip"
  function_name = "example-rotation-function"
  role          = awscc_iam_role.lambda_role.arn
  handler       = "index.handler"
  runtime       = "python3.9"

  # Dummy code for example purposes
  source_code_hash = filebase64sha256("rotation.zip")
}

# Allow Secrets Manager to invoke the Lambda function
resource "aws_lambda_permission" "allow_secrets_manager" {
  statement_id  = "AllowSecretsManagerInvoke"
  action        = "lambda:InvokeFunction"
  function_name = aws_lambda_function.rotation.function_name
  principal     = "secretsmanager.amazonaws.com"
}

# Create the rotation schedule
resource "awscc_secretsmanager_rotation_schedule" "example" {
  secret_id           = awscc_secretsmanager_secret.example.id
  rotation_lambda_arn = aws_lambda_function.rotation.arn
  rotation_rules = {
    automatically_after_days = 30
    duration                 = "3h"
  }
  rotate_immediately_on_update = true
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `secret_id` (String) The ARN or name of the secret to rotate.

### Optional

- `hosted_rotation_lambda` (Attributes) Creates a new Lambda rotation function based on one of the Secrets Manager rotation function templates. To use a rotation function that already exists, specify RotationLambdaARN instead. (see [below for nested schema](#nestedatt--hosted_rotation_lambda))
- `rotate_immediately_on_update` (Boolean) Specifies whether to rotate the secret immediately or wait until the next scheduled rotation window.
- `rotation_lambda_arn` (String) The ARN of an existing Lambda rotation function. To specify a rotation function that is also defined in this template, use the Ref function.
- `rotation_rules` (Attributes) A structure that defines the rotation configuration for this secret. (see [below for nested schema](#nestedatt--rotation_rules))

### Read-Only

- `id` (String) Uniquely identifies the resource.
- `rotation_schedule_id` (String) The ARN of the secret.

<a id="nestedatt--hosted_rotation_lambda"></a>
### Nested Schema for `hosted_rotation_lambda`

Optional:

- `exclude_characters` (String) A string of the characters that you don't want in the password.
- `kms_key_arn` (String) The ARN of the KMS key that Secrets Manager uses to encrypt the secret. If you don't specify this value, then Secrets Manager uses the key aws/secretsmanager. If aws/secretsmanager doesn't yet exist, then Secrets Manager creates it for you automatically the first time it encrypts the secret value.
- `master_secret_arn` (String) The ARN of the secret that contains superuser credentials, if you use the alternating users rotation strategy. CloudFormation grants the execution role for the Lambda rotation function GetSecretValue permission to the secret in this property.
- `master_secret_kms_key_arn` (String) The ARN of the KMS key that Secrets Manager used to encrypt the superuser secret, if you use the alternating users strategy and the superuser secret is encrypted with a customer managed key. You don't need to specify this property if the superuser secret is encrypted using the key aws/secretsmanager. CloudFormation grants the execution role for the Lambda rotation function Decrypt, DescribeKey, and GenerateDataKey permission to the key in this property.
- `rotation_lambda_name` (String) The name of the Lambda rotation function.
- `rotation_type` (String) The type of rotation template to use
- `runtime` (String) The python runtime associated with the Lambda function
- `superuser_secret_arn` (String) The ARN of the secret that contains superuser credentials, if you use the alternating users rotation strategy. CloudFormation grants the execution role for the Lambda rotation function GetSecretValue permission to the secret in this property.
- `superuser_secret_kms_key_arn` (String) The ARN of the KMS key that Secrets Manager used to encrypt the superuser secret, if you use the alternating users strategy and the superuser secret is encrypted with a customer managed key. You don't need to specify this property if the superuser secret is encrypted using the key aws/secretsmanager. CloudFormation grants the execution role for the Lambda rotation function Decrypt, DescribeKey, and GenerateDataKey permission to the key in this property.
- `vpc_security_group_ids` (String) A comma-separated list of security group IDs applied to the target database.
- `vpc_subnet_ids` (String) A comma separated list of VPC subnet IDs of the target database network. The Lambda rotation function is in the same subnet group.


<a id="nestedatt--rotation_rules"></a>
### Nested Schema for `rotation_rules`

Optional:

- `automatically_after_days` (Number) The number of days between automatic scheduled rotations of the secret. You can use this value to check that your secret meets your compliance guidelines for how often secrets must be rotated.
- `duration` (String) The length of the rotation window in hours, for example 3h for a three hour window. Secrets Manager rotates your secret at any time during this window. The window must not extend into the next rotation window or the next UTC day. The window starts according to the ScheduleExpression. If you don't specify a Duration, for a ScheduleExpression in hours, the window automatically closes after one hour. For a ScheduleExpression in days, the window automatically closes at the end of the UTC day.
- `schedule_expression` (String) A cron() or rate() expression that defines the schedule for rotating your secret. Secrets Manager rotation schedules use UTC time zone.

## Import

Import is supported using the following syntax:

In Terraform v1.12.0 and later, the [`import` block](https://developer.hashicorp.com/terraform/language/import) can be used with the `identity` attribute, for example:

```terraform
import {
  to = awscc_secretsmanager_rotation_schedule.example
  identity = {
    id = "id"
  }
}
```

<!-- schema generated by tfplugindocs -->
### Identity Schema

#### Required

- `id` (String) The ARN of the secret

#### Optional

- `account_id` (String) The ID of the AWS account
- `region` (String) The AWS region where the resource is located

In Terraform v1.5.0 and later, the [`import` block](https://developer.hashicorp.com/terraform/language/import) can be used with the `id` attribute, for example:

```terraform
import {
  to = awscc_secretsmanager_rotation_schedule.example
  id = "id"
}
```

The [`terraform import` command](https://developer.hashicorp.com/terraform/cli/commands/import) can be used, for example:

```shell
$ terraform import awscc_secretsmanager_rotation_schedule.example "id"
```
